<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IdiotMouth</title>
<script type="text/javascript">
// MESSAGE TYPES (CLIENT TO SERVER)
// when using conn.send(), the first character in the string represents the message type
// 0 means regular chat message, 1 means setting player name
window.onload = function () {
    //collapsible start
    var coll = document.getElementsByClassName("collapsible-button");
    var i;

    for (i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function() {
            this.classList.toggle("collapsible-button-active");
            var content = this.nextElementSibling;
            if (content.style.maxHeight){
            content.style.maxHeight = null;
            } else {
            content.style.maxHeight = content.scrollHeight + "px";
            } 
        });
    }
    //collapsible end

    var conn, name;
    var landing = document.getElementById("landing");
    var nameForm = document.getElementById("name-form");
    var nameField = document.getElementById("name-field");
    var ingame = document.getElementById("ingame");
    var msg = document.getElementById("msg");
    var log = document.getElementById("log");

    function appendLog(item) {
        var doScroll = log.scrollTop > log.scrollHeight - log.clientHeight - 1;
        log.appendChild(item);
        if (doScroll) {
            log.scrollTop = log.scrollHeight - log.clientHeight;
        }
    }

    nameForm.onsubmit = function (e) {
        if (!conn) {
            return false;
        }
        if (!nameField.value.trim()) {
            return false;
        }
        name = nameField.value;
        conn.send("1" + name);
        e.preventDefault();
        landing.parentNode.removeChild(landing);
        ingame.style.visibility = "visible";
    }

    document.getElementById("chat-form").onsubmit = function () {
        if (!conn) {
            return false;
        }
        if (!msg.value.trim()) {
            return false;
        }
        if (msg.value.trim()=="/rules") {
            var item = document.createElement("div");
            item.innerHTML = "<br/><b>Rules</b><br/>At the bottom are two letters. Try to think of a word that starts with the first letter and ends with the second.<br/>You get points for harder letters and longer words. Words must be >2 letters.<br/>You can also enter '/pass' if the letters are too hard to vote to skip the current letters.<br/>You can enter '/restart' at any time to restart the game.<br/>";
            appendLog(item);
            msg.value = "";
            return false;
        }
        conn.send("0" + msg.value);
        msg.value = "";
        return false;
    };

    if (window["WebSocket"]) {
        var websocketprotocol = "ws://";
        if (document.location.protocol==="https:") {
            websocketprotocol = "wss://";
        }
        conn = new WebSocket(websocketprotocol + document.location.host + document.location.pathname);
        conn.onclose = function (evt) {
            var item = document.createElement("div");
            item.innerHTML = "<b>Connection closed.</b>";
            appendLog(item);
        };
        conn.onmessage = function (evt) {
            var messages = evt.data.split('\n');
            for (var i = 0; i < messages.length; i++) {
                var m = messages[i]
                var messageType = m.charAt(0);
                var message = m.substring(1,m.length)
                switch (messageType) {
                case '0':
                    var item = document.createElement("div");
                    message = message.replaceAll("<br/>", "\n")
                    item.innerText = message;
                    appendLog(item);
                    break;
                case '1':
                    document.getElementById("status").innerText = "Scores: " + message;
                    break
                case '2':
                    document.getElementById("prompt").innerText = message;
                    break
                case '3':
                    while (log.firstChild) {
                        log.removeChild(log.firstChild);
                    }
                    break
                }
            }
        };
    } else {
        var item = document.createElement("div");
        item.innerHTML = "<b>Your browser does not support WebSockets.</b>";
        appendLog(item);
    }

    ingame.style.visibility = "hidden";
};
</script>
<style type="text/css">

.menu {
  margin: auto;
  width: 20%;
  text-align: center;
}

.menu a {
  background-color: #e5e5e5;
  padding: 8px;
  margin-top: 7px;
  display: block;
  width: 100%;
  color: black;
}

.main {
  margin: auto;
  width: 60%;
  padding: 0 20px;
}

.right {
  margin: auto;
  background-color: #e5e5e5;
  width: 20%;
  padding: 15px;
  margin-top: 7px;
  text-align: center;
}

@media only screen and (max-width: 620px) {
  /* For mobile phones: */
  .menu, .main, .right {
    width: 100%;
  }
}

html {
    overflow: hidden;
}

body {
    overflow: hidden;
    padding: 0;
    margin: 0;
    width: 100%;
    height: 100%;
}

#name-form {
    padding: 0.5em 0.5em 0.5em 0.5em;
    text-align: center;
}

#name-form > input {
    margin: 5px 0px;
}

#log {
    overflow: auto;
}

.collapsible-button {
  background-color: #777;
  color: white;
  cursor: pointer;
  padding: 18px;
  width: 100%;
  border: none;
  text-align: left;
  outline: none;
  font-size: 15px;
}

.collapsible-button-active, .collapsible-button:hover {
  background-color: #555;
}

.collapsible-button:after {
  content: '\23F7';
  color: white;
  font-weight: bold;
  float: right;
  margin-left: 5px;
}

.collapsible-button-active:after {
  content: "\23F6";
}

.collapsible-content {
  padding: 0 18px;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.2s ease-out;
  background-color: #f1f1f1;
}

#landing {
    padding: 15px 0px;
    position: absolute;
    width: 500px;
    left: 50%;
    margin-left: -250px;
}

#landing > div {
    margin: 20px 0px;
}

#landing-title {
    background-color: #e5e5e5;
    padding: 15px;
    text-align: center;
}

#ingame {
    padding: 15px 0px;
    position: absolute;
    width: 500px;
    left: 50%;
    margin-left: -250px;
    display: flex;
    flex-direction: row;
}

#ingame-left {
    width: 30%;
}

#ingame-right {
    width: 70%;
}

#chat-form {
    display: flex;
    flex-direction: row;
    gap: 5px;
}

</style>
</head>
<body>
    <div id="landing">
        <div id="landing-title">
            <h1>Idiotmouth</h1>
        </div>
        <div>
            <form id="name-form">
                <input type="text" id="name-field" size="64" maxlength="20" placeholder="Name" autofocus />
                <input type="submit" value="Set Name" />
            </form>
        </div>
        <div>
            <button class="collapsible-button">How to play</button>
            <div class="collapsible-content">
                <p>This isn't finished yet go click on something else</p>
            </div>
        </div>
    </div>

    <div id="ingame">
        <div id="ingame-left">
            <div id="status">status</div>
        </div>
        <div id="ingame-right">
            <div id="prompt">prompt</div>
            <div id="log"></div>
            <form id="chat-form">
                <input type="text" id="msg" size="64" maxlength="100" placeholder="type /rules for rules" />
                <input type="submit" value="Send" />
            </form>
        </div>
    </div>
</body>
</html>