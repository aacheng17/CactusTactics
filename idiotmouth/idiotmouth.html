<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IdiotMouth</title>
<script type="text/javascript">
// MESSAGE TYPES (CLIENT TO SERVER)
// when using conn.send(), the first character in the string represents the message type
// 0 means regular chat message, 1 means setting player name, 2 means skip, 3 means restart
window.onload = function () {
    
    //collapsible start
    var coll = document.getElementsByClassName("collapsible-button");
    for (i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function() {
            this.classList.toggle("collapsible-button-active");
            var content = this.nextElementSibling;
            if (content.style.maxHeight){
            content.style.maxHeight = null;
            } else {
            content.style.maxHeight = content.scrollHeight + "px";
            } 
        });
    }
    //collapsible end

    var conn, name;
    var landing = document.getElementById("landing");
    var nameForm = document.getElementById("name-form");
    var nameField = document.getElementById("name-field");
    var ingame = document.getElementById("ingame");
    var ingameHowtoplayButton = document.getElementById("ingame-howtoplay-button");
    var ingameHowtoplay = document.getElementById("ingame-howtoplay");
    var restart = document.getElementById("restart");
    var players = document.getElementById("players");
    var startLetter = document.getElementById("start-letter");
    var endLetter = document.getElementById("end-letter");
    var skip = document.getElementById("skip")
    var promptExtraText = document.getElementById("prompt-extra-text");
    var msg = document.getElementById("msg");
    var log = document.getElementById("log");

    function appendLog(item) {
        var doScroll = log.scrollTop > log.scrollHeight - log.clientHeight - 1;
        log.appendChild(item);
        if (doScroll) {
            log.scrollTop = log.scrollHeight - log.clientHeight;
        }
    }

    if (nameForm !== null) {
        nameForm.onsubmit = function (e) {
            if (!conn) {
                return false;
            }
            if (!nameField.value.trim()) {
                return false;
            }
            name = nameField.value;
            conn.send("1" + name);
            e.preventDefault();
            landing.parentNode.removeChild(landing);
            ingame.style.visibility = "visible";
        }
    }

    ingameHowtoplayButton.addEventListener("click", function() {
        if (ingameHowtoplay.style.maxHeight){
            ingameHowtoplay.style.maxHeight = null;
        } else {
            ingameHowtoplay.style.maxHeight = ingameHowtoplay.scrollHeight + "px";
        } 
    });

    restart.onclick = function (e) {
        if (!conn) {
            return false;
        }
        conn.send("3");
    }

    skip.onclick = function (e) {
        if (!conn) {
            return false;
        }
        conn.send("2");
    }
    
    document.getElementById("chat-form").onsubmit = function () {
        if (!conn) {
            return false;
        }
        if (!msg.value.trim()) {
            return false;
        }
        if (msg.value.trim()=="/rules") {
            var item = document.createElement("div");
            item.innerHTML = "<br/><b>Rules</b><br/>At the bottom are two letters. Try to think of a word that starts with the first letter and ends with the second.<br/>You get points for harder letters and longer words. Words must be >2 letters.<br/>You can also enter '/pass' if the letters are too hard to vote to skip the current letters.<br/>You can enter '/restart' at any time to restart the game.<br/>";
            appendLog(item);
            msg.value = "";
            return false;
        }
        conn.send("0" + msg.value);
        msg.value = "";
        return false;
    };

    if (window["WebSocket"]) {
        var websocketprotocol = "ws://";
        if (document.location.protocol==="https:") {
            websocketprotocol = "wss://";
        }
        conn = new WebSocket(websocketprotocol + document.location.host + document.location.pathname);
        conn.onclose = function (evt) {
            var item = document.createElement("div");
            item.innerHTML = "<b>Connection closed.</b>";
            appendLog(item);
        };
        conn.onmessage = function (evt) {
            var messages = evt.data.split('\n');
            for (var i = 0; i < messages.length; i++) {
                var m = messages[i]
                var messageType = m.charAt(0);
                var message = m.substring(1,m.length)
                switch (messageType) {
                case '0':
                    var item = document.createElement("div");
                    message = message.replaceAll("<br/>", "\n")
                    item.innerText = message;
                    appendLog(item);
                    break;
                case '1':
                    while (players.firstChild) {
                        players.removeChild(players.firstChild);
                    }
                    var data = message.split("|");
                    for (var j = 0; j < data.length; j+=4) {
                        var player = document.createElement("div");
                        player.id = "player";
                        var text = data[j] + " - " + data[j+1].toString() + " points";
                        if (data[j+2] != "") {
                            text += "\nBest word: " + data[j+2] + " " + data[j+3].toString() + " points";
                        }
                        player.innerText = text;
                        players.appendChild(player);
                    }
                    break
                case '2':
                    var data = message.split("|");
                    var sl = data[0].toUpperCase();
                    var el = data[1].toUpperCase();
                    startLetter.innerText = sl;
                    endLetter.innerText = el;
                    msg.placeholder = "a word that starts with " + sl + " and ends with " + el;
                    promptExtraText.innerText = "Worth " + String(data[2]) + " points. There are " + String(data[3]) + " possible words.";
                    break
                case '3':
                    while (log.firstChild) {
                        log.removeChild(log.firstChild);
                    }
                    break
                }
            }
        };
    } else {
        var item = document.createElement("div");
        item.innerHTML = "<b>Your browser does not support WebSockets.</b>";
        appendLog(item);
    }

    ingame.style.visibility = "hidden";
};
</script>
<style type="text/css">
.collapsible-button {
  background-color: #777;
  color: white;
  cursor: pointer;
  padding: 15px;
  width: 100%;
  border: none;
  text-align: left;
  outline: none;
}

.collapsible-button:after {
  content: '\23F7';
  color: white;
  font-weight: bold;
  float: right;
  margin-left: 5px;
}

.collapsible-button-active:after {
  content: "\23F6";
}

.collapsible-content {
  padding: 0 15px;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.2s ease-out;
  background-color: #f1f1f1;
}

@media only screen and (max-width: 620px) {
  /* For mobile phones: */
  .menu, .main, .right {
    width: 100%;
  }
}

* {
    font-family: Arial, Helvetica, sans-serif;
}

html {
    overflow: hidden;
}

body {
    overflow: hidden;
    padding: 0;
    margin: 0;
    width: 100%;
    height: 100%;
}

h1, h2 {
    margin: 0px;
}

button {
    padding: 5px;
}

#landing {
    padding: 15px 0px;
    position: absolute;
    width: 500px;
    left: 50%;
    margin-left: -250px;
    display: grid;
    flex-direction: column;
    gap: 30px;
}

#landing-title {
    background-color: #e5e5e5;
    text-align: center;
    padding: 15px;
}

#name-form {
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}

#name-form-submit {
    padding: 5px;
}

#ingame {
    padding: 15px 0px;
    position: absolute;
    width: 800px;
    left: 50%;
    margin-left: -400px;
    display: flex;
    flex-direction: row;
    gap: 15px;
}

#ingame-left {
    width: 30%;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

#ingame-right {
    width: 70%;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

#ingame-title {
    background-color: #e5e5e5;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    padding: 15px;
}

#players {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

#player {
    background-color: #f5f5f5;
    padding: 15px;
    overflow: hidden;
}

#prompt {
    background-color: #e5e5e5;
    padding: 15px;
}

#prompt-text {
    display: flex;
    flex-direction: row;
    gap: 10px;
}

#chatbox {
    background-color: #e5e5e5;
    display: flex;
    flex-direction: column;
}

#log {
    padding: 15px;
    overflow: auto;
    height: 400px;
}

#chat-form {
    padding: 5px;
    display: flex;
    flex-direction: row;
    gap: 5px;
}

#msg {
    flex-grow: 100;
}

#msg-send {
    padding: 5px 5px;
}

</style>
</head>
<body>
    <div id="landing">
        <div id="landing-title">
            <h1>Idiotmouth</h1>
        </div>
        <div>
            <form id="name-form">
                <input type="text" id="name-field" size="64" maxlength="20" placeholder="Name" autofocus />
                <input id="name-form-submit" type="submit" value="Set Name" />
            </form>
        </div>
        <div>
            <button class="collapsible-button">How to play</button>
            <div class="collapsible-content">
                <p>This isn't finished yet go click on something else</p>
            </div>
        </div>
    </div>

    <div id="ingame">
        <div id="ingame-left">
            <div id="ingame-title-holder">
                <div id="ingame-title">
                    <h1>Idiotmouth</h1>
                    <div>
                        <button id="ingame-howtoplay-button">how to play</button>
                        <button id="restart">reset game</button>
                    </div>
                </div>
                <div id="ingame-howtoplay" class="collapsible-content">
                    <p>This isn't finished yet go click on something else</p>
                </div>
            </div>
            <div id="players">status</div>
        </div>
        <div id="ingame-right">
            <div id="prompt">
                <div id="prompt-text">
                    <h2>Current Letters:</h2>
                    <h2 id="start-letter"></h2>
                    <h2 id="end-letter"></h2>
                    <button id="skip">Vote to skip</button>
                </div>
                <a id="prompt-extra-text"></a>
            </div>
            <div id="chatbox">
                <div id="log"></div>
                <form id="chat-form">
                    <input type="text" id="msg" size="64" maxlength="100"/>
                    <input type="submit" id="msg-send" value="Send" />
                </form>
            </div>
        </div>
    </div>
</body>
</html>